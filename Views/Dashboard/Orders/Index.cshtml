@model List<OnlineStoreMVC.Models.ViewModels.OrderManageViewModel>
@using OnlineStoreMVC.Helpers

@{
  Layout = "~/Views/Shared/_DashboardLayout.cshtml";
  ViewData["Title"] = "Qu·∫£n l√Ω ƒë∆°n h√†ng";
}

<div class="d-flex justify-content-between align-items-center mb-3">
  <h2>üßæ Danh s√°ch ƒë∆°n h√†ng</h2>
  <a class="btn btn-success" href="/Dashboard/Orders/Create">‚ûï T·∫°o m·ªõi</a>
</div>

<table class="table table-bordered table-hover">
  <thead class="table-dark">
    <tr>
      <th>#</th>
      <th>Ng∆∞·ªùi ƒë·∫∑t</th>
      <th>Ng√†y ƒë·∫∑t</th>
      <th>Tr·∫°ng th√°i</th>
      <th>T·ªïng g·ªëc</th>
      <th>T·ªïng sau gi·∫£m</th>
      <th>Ghi ch√∫</th>
      <th>Thao t√°c</th>
    </tr>
  </thead>
  <tbody>
    @for (int i = 0; i < Model.Count; i++)
    {
      var order = Model[i];
      bool locked = order.Status == "Shipping" || order.Status == "Completed";
      <tr>
        <td>@(i + 1)</td>
        <td>@order.UserName</td>
        <td>@order.OrderDate.ToString("dd/MM/yyyy HH:mm")</td>
        <td>@order.Status</td>
        <td>@FormatHelper.FormatCurrency(order.TotalAmount)</td>
        <td>@FormatHelper.FormatCurrency(order.TotalAfterDiscount)</td>
        <td>@order.Description</td>
        <td>
          <button class="btn btn-sm btn-info" type="button" data-bs-toggle="collapse"
            data-bs-target="#details-@order.OrderID" aria-expanded="false" aria-controls="details-@order.OrderID">
            Chi ti·∫øt
          </button>
          <a class="btn btn-sm btn-primary" href="/Dashboard/Orders/Edit/@order.OrderID">
            S·ª≠a
          </a>
          @if (!locked)
          {
            <form asp-action="Delete" asp-route-id="@order.OrderID" method="post" class="d-inline"
              onsubmit="return confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a?');">
              <button type="submit" class="btn btn-sm btn-danger">X√≥a</button>
            </form>
          }
          else
          {
            <button class="btn btn-sm btn-danger disabled" title="Kh√¥ng th·ªÉ x√≥a khi ƒë∆°n ƒëang giao ho·∫∑c ƒë√£ ho√†n th√†nh">
              X√≥a
            </button>
          }
        </td>
      </tr>
      <tr>
        <td colspan="8" class="p-0 bg-light">
          <div class="collapse" id="details-@order.OrderID">
            <div class="p-3">
              <strong>Chi ti·∫øt ƒë∆°n h√†ng:</strong>
              <table class="table table-sm table-striped mt-2 mb-0">
                <thead>
                  <tr>
                    <th>S·∫£n ph·∫©m</th>
                    <th>Size</th>
                    <th>M√†u s·∫Øc</th>
                    <th>S·ªë l∆∞·ª£ng</th>
                    <th>ƒê∆°n gi√°</th>
                    <th>% Gi·∫£m</th>
                    <th>Th√†nh ti·ªÅn</th>
                    <th>Ti·ªÅn sau gi·∫£m</th>
                  </tr>
                </thead>
                <tbody>
                  @foreach (var item in order.Items)
                  {
                    <tr>
                      <td>@item.ProductName</td>
                      <td>@item.Size</td>
                      <td>@item.Color</td>
                      <td>@item.Quantity</td>
                      <td>@FormatHelper.FormatCurrency(item.UnitPrice)</td>
                      <td>@item.SalePercent %</td>
                      <td>@FormatHelper.FormatCurrency(item.Amount)</td>
                      <td>@FormatHelper.FormatCurrency(item.DiscountedAmount)</td>
                    </tr>
                  }
                </tbody>
              </table>
            </div>
          </div>
        </td>
      </tr>
    }
  </tbody>
</table>