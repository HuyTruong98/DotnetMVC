@model List<OnlineStoreMVC.Models.Promotion>
@using OnlineStoreMVC.Helpers

@{
  Layout = "~/Views/Shared/_DashboardLayout.cshtml";
  ViewData["Title"] = "Qu·∫£n l√Ω khuy·∫øn m√£i";
}

<div class="d-flex justify-content-between align-items-center mb-3">
  <h2>üéÅ Danh s√°ch khuy·∫øn m√£i</h2>
  <a class="btn btn-success" href="/Dashboard/Promotions/Create">‚ûï T·∫°o m·ªõi</a>
</div>

<table class="table table-bordered table-hover">
  <thead class="table-dark">
    <tr>
      <th>#</th>
      <th>S·∫£n ph·∫©m</th>
      <th>Gi·∫£m (%)</th>
      <th>B·∫Øt ƒë·∫ßu</th>
      <th>K·∫øt th√∫c</th>
      <th>Tr·∫°ng th√°i</th>
      <th>Thao t√°c</th>
    </tr>
  </thead>
  <tbody>
    @if (Model.Any())
    {
      for (int i = 0; i < Model.Count; i++)
      {
        var promo = Model[i];
        var now = DateTime.Now;
        string status = (promo.EndDate == null || promo.EndDate >= now) && promo.StartDate <= now
        ? "ƒêang √°p d·ª•ng"
        : "H·∫øt h·∫°n";

        string badgeClass = status switch
        {
          "ƒêang √°p d·ª•ng" => "bg-success",
          "H·∫øt h·∫°n" => "bg-danger",
          _ => "bg-secondary"
        };

        <tr>
          <td>@(i + 1)</td>
          <td>@promo.Product?.ProductName</td>
          <td>@promo.DiscountPercent%</td>
          <td>@FormatHelper.FormatDate(promo.StartDate)</td>
          <td>@(promo.EndDate.HasValue? FormatHelper.FormatDate(promo.EndDate.Value) : "Kh√¥ng gi·ªõi h·∫°n")</td>
          <td><span class="badge @badgeClass">@status</span></td>
          <td>
            <a class="btn btn-sm btn-primary" href="/Dashboard/Promotions/Edit/@promo.PromotionID">S·ª≠a</a>
            <a class="btn btn-sm btn-danger" href="/Dashboard/Promotions/Delete/@promo.PromotionID"
              onclick="return confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a khuy·∫øn m√£i n√†y?');">X√≥a</a>
          </td>
        </tr>
      }
    }
    else
    {
      <tr>
        <td colspan="7" class="text-center text-muted">Ch∆∞a c√≥ khuy·∫øn m√£i n√†o.</td>
      </tr>
    }
  </tbody>
</table>