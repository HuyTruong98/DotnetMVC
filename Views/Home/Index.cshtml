@using OnlineStoreMVC.Helpers
@model List<OnlineStoreMVC.Models.Product>
@{
  var featuredProducts = ViewBag.FeaturedProducts as List<OnlineStoreMVC.Models.Product> ?? new();
  var promotionProducts = ViewBag.PromotionProducts as List<OnlineStoreMVC.Models.Promotion> ?? new();
}

@{
  ViewData["Title"] = "Home Page";
}

@{
  ViewData["Title"] = "Trang chủ - Cửa hàng thời trang";
}

<!-- Views/Home/Index.cshtml -->
<section id="heroCarousel" class="carousel slide" data-bs-ride="carousel" data-bs-interval="3000">

  <div class="carousel-inner">
    <div class="carousel-item active">
      <img src="~/images/banner_trang_ch__pc__2048x813px_-01.jpg" class="d-block w-100" alt="Slide 1"
        style="object-fit: cover; height: 80vh;" />
    </div>
    <div class="carousel-item">
      <img src="~/images/banner_trang_ch__pc__2048x813px_-02.jpg" class="d-block w-100" alt="Slide 2"
        style="object-fit: cover; height: 80vh;" />
    </div>
    <div class="carousel-item">
      <img src="~/images/banner_trang_ch__pc__2048x813px_-03__1_.jpg" class="d-block w-100" alt="Slide 3"
        style="object-fit: cover; height: 80vh;" />
    </div>
  </div>

  <!-- Custom Prev/Next Buttons -->
  <button type="button" class="custom-control-btn custom-prev" data-bs-target="#heroCarousel" data-bs-slide="prev">
    <i class="fas fa-chevron-left"></i>
  </button>
  <button type="button" class="custom-control-btn custom-next" data-bs-target="#heroCarousel" data-bs-slide="next">
    <i class="fas fa-chevron-right"></i>
  </button>
</section>

<!-- Features Section -->
<section class="features-section py-3">
  <div class="container">
    <div class="row g-4">
      <div class="col-lg-3 col-md-6">
        <div class="feature-item text-center">
          <div class="feature-icon">
            <img src="~/images/freeShipping.png" style="height:30px" asp-append-version="true" />
          </div>
          <h5>Miễn phí vận chuyển</h5>
          <p>đơn từ 500k</p>
        </div>
      </div>
      <div class="col-lg-3 col-md-6">
        <div class="feature-item text-center">
          <div class="feature-icon">
            <img src="~/images/refresh.png" style="height:30px" asp-append-version="true" />
          </div>
          <h5>Đổi hàng tận nhà</h5>
          <p>Trong vòng 15 ngày</p>
        </div>
      </div>
      <div class="col-lg-3 col-md-6">
        <div class="feature-item text-center">
          <div class="feature-icon">
            <img src="~/images/quantity.png" style="height:30px" asp-append-version="true" />
          </div>
          <h5>Chất lượng cao</h5>
          <p>Sản phẩm chính hãng</p>
        </div>
      </div>
      <div class="col-lg-3 col-md-6">
        <div class="feature-item text-center">
          <div class="feature-icon">
            <img src="~/images/support.png" style="height:30px" asp-append-version="true" />
          </div>
          <h5>Hỗ trợ 24/7</h5>
          <p>Tư vấn và hỗ trợ khách hàng 24/7</p>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Collections Section -->
<section id="collections" class="collections-section py-3 bg-light">
  <div class="container">
    <div class="section-header text-center mb-5">
      <h2 class="section-title">Bộ sưu tập thời trang</h2>
      <p class="section-subtitle">Khám phá các danh mục sản phẩm đa dạng của chúng tôi</p>
    </div>

    <div class="row g-4">
      <div class="col-lg-4 col-md-6">
        <div class="collection-card">
          <div class="collection-image">
            <img src="/uploads/products/yVOv85MEGoLxrAmUTh0xdetVyzNggkm8OjZQqb0c.jpg" alt="Thời trang nam">
            <div class="collection-overlay">
              <div class="collection-content">
                <h4>Thời trang nam</h4>
                <p>Phong cách lịch lãm, hiện đại</p>
                <a asp-controller="HomeProduct" asp-action="ByCategory" asp-route-categoryIds="1,3"
                  class="btn btn-light">
                  Xem ngay
                </a>
              </div>
            </div>
          </div>
        </div>

      </div>

      <div class="col-lg-4 col-md-6">
        <div class="collection-card">
          <div class="collection-image">
            <img src="/uploads/products/unnamed.png" alt="Thời trang nữ">
            <div class="collection-overlay">
              <div class="collection-content">
                <h4>Thời trang nữ</h4>
                <p>Thanh lịch, quyến rũ</p>
                <a asp-controller="HomeProduct" asp-action="ByCategory" asp-route-categoryIds="2,4"
                  class="btn btn-light">
                  Xem ngay
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="col-lg-4 col-md-6">
        <div class="collection-card">
          <div class="collection-image">
            <img src="/uploads/products/phu-kien-thoi-trang-8.jpg" alt="Phụ kiện">
            <div class="collection-overlay">
              <div class="collection-content">
                <h4>Phụ kiện</h4>
                <p>Hoàn thiện phong cách</p>
                <a asp-controller="HomeProduct" asp-action="ByCategory" asp-route-categoryIds="5,6,7"
                  class="btn btn-light">
                  Xem ngay
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Featured Products -->
<section class="featured-products py-3">
  <div class="container">
    <div class="section-header text-center mb-5">
      <h2 class="section-title">Sản phẩm nổi bật</h2>
      <p class="section-subtitle">Những sản phẩm được yêu thích nhất</p>
    </div>

    <div class="row g-4">
      @foreach (var product in featuredProducts)
      {
        var promotions = ViewBag.Promotions as List<OnlineStoreMVC.Models.Promotion> ?? new();
        var promo = promotions.FirstOrDefault(p => p.ProductID == product.ProductID);
        var discountedPrice = promo != null
        ? product.Price * (1 - (decimal)promo.DiscountPercent / 100)
        : 0m;

        var primaryImage = product?.ProductImages?.FirstOrDefault(img => img.IsPrimary);

        <div class="col-lg-3 col-md-6">
          <div class="product-card">
            <div class="product-image">
              <a asp-controller="HomeProduct" asp-action="Detail" asp-route-id="@product.ProductID">
                <img src="@(primaryImage?.ImageURL ?? "/images/no-image.png")" class="img-hot"
                  alt="@product.ProductName" />
              </a>
              <div class="product-badges">
                <span class="badge bg-warning">Hot</span>
              </div>
              <div class="product-actions">
                <button class="btn btn-sm btn-outline-light" title="Yêu thích">
                  <img style="height: 20px" src="~/images/heart.png" />
                </button>
                <a asp-controller="HomeProduct" asp-action="Detail" asp-route-id="@product.ProductID"
                  class="btn btn-sm btn-outline-light" title="Xem nhanh">
                  <img style="height: 10px" src="~/images/view.png" />
                </a>
              </div>
            </div>
            <div class="product-info">
              <h6 class="product-title"> <a asp-controller="HomeProduct" asp-action="Detail"
                  asp-route-id="@product.ProductID" class="text-decoration-none text-dark">
                  @product.ProductName
                </a></h6>


              <div class="product-price">
                @if (promo != null)
                {
                  <span class="current-price">
                    <del class="price-sale">
                      @FormatHelper.FormatCurrency(product.Price)
                    </del>
                  </span>
                  <span class="current-price">
                    @FormatHelper.FormatCurrency(discountedPrice)
                  </span>
                }
                else
                {
                  <span class="current-price">
                    @FormatHelper.FormatCurrency(product.Price)
                  </span>
                }
                @* <span class="old-price">400.000₫</span> *@
              </div>
              <div class="mt-2">
                <a asp-controller="HomeProduct" asp-action="Detail" asp-route-id="@product.ProductID"
                  class="btn btn-sm btn-primary w-100 add-to-cart-btn text-decoration-none d-flex align-items-center justify-content-center gap-2"
                  data-product-id="@product.ProductID">
                  <i class="fas fa-eye"></i>
                  <span>Xem Chi Tiết</span>
                </a>
              </div>
            </div>
          </div>
        </div>
      }
    </div>
  </div>
</section>

<section class="featured-products py-3 bg-light">
  <div class="container">
    <div class="section-header text-center mb-5">
      <h2 class="section-title">Khuyến mãi HOT</h2>
      <p class="section-subtitle">Đừng bỏ lỡ cơ hội mua hàng giá tốt</p>
    </div>

    <div class="row g-4">
      @foreach (var promo in promotionProducts)
      {
        var product = promo.Product;
        var primaryImage = product?.ProductImages?.FirstOrDefault(img => img.IsPrimary);
        var discountedPrice = product.Price * (1 - (decimal)promo.DiscountPercent / 100);

        <div class="col-lg-3 col-md-6">
          <div class="product-card">
            <div class="product-image">
              <a asp-controller="HomeProduct" asp-action="Detail" asp-route-id="@product.ProductID">
                <img src="@(primaryImage?.ImageURL ?? "/images/no-image.png")" class="img-hot"
                  alt="@product.ProductName" />
              </a>
              <div class="product-badges">
                <span class="badge bg-danger">-@promo.DiscountPercent%</span>
              </div>
              <div class="product-actions">
                <button class="btn btn-sm btn-outline-light" title="Yêu thích">
                  <img style="height: 20px" src="~/images/heart.png" />
                </button>
                <a asp-controller="HomeProduct" asp-action="Detail" asp-route-id="@product.ProductID"
                  class="btn btn-sm btn-outline-light" title="Xem nhanh">
                  <img style="height: 10px" src="~/images/view.png" />
                </a>
              </div>
            </div>
            <div class="product-info">
              <h6 class="product-title"> <a asp-controller="HomeProduct" asp-action="Detail"
                  asp-route-id="@product.ProductID" class="text-decoration-none text-dark">
                  @product.ProductName
                </a></h6>


              <div class="product-price">
                @if (promo != null)
                {
                  <span class="current-price">
                    <del class="price-sale">
                      @FormatHelper.FormatCurrency(product.Price)
                    </del>
                  </span>
                  <span class="current-price">
                    @FormatHelper.FormatCurrency(discountedPrice)
                  </span>
                }
                else
                {
                  <span class="current-price">
                    @FormatHelper.FormatCurrency(product.Price)
                  </span>
                }
                @* <span class="old-price">400.000₫</span> *@
              </div>
              <div class="mt-2">
                <a asp-controller="HomeProduct" asp-action="Detail" asp-route-id="@product.ProductID"
                  class="btn btn-sm btn-primary w-100 add-to-cart-btn text-decoration-none d-flex align-items-center justify-content-center gap-2"
                  data-product-id="@product.ProductID">
                  <i class="fas fa-eye"></i>
                  <span>Xem Chi Tiết</span>
                </a>
              </div>
            </div>
          </div>
        </div>
      }
    </div>

    <div class="text-center mt-5">
      <a asp-controller="HomeProduct" asp-action="All" class="btn btn-primary btn-lg">
        Xem tất cả sản phẩm <i class="fas fa-arrow-right ms-2"></i>
      </a>
    </div>
  </div>
</section>

<!-- Newsletter Section -->
<section class="newsletter-section py-5 bg-dark text-white">
  <div class="container">
    <div class="row align-items-center">
      <div class="col-lg-6">
        <h3 class="mb-3">Đăng ký nhận tin tức</h3>
        <p class="mb-0">Nhận thông tin về sản phẩm mới và ưu đãi đặc biệt qua email</p>
      </div>
      <div class="col-lg-6">
        <form class="newsletter-form">
          <div class="input-group">
            <input type="email" class="form-control form-control-lg" placeholder="Nhập email của bạn...">
            <button class="btn btn-primary btn-lg" type="submit">
              <i class="fas fa-paper-plane me-2"></i>Đăng ký
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</section>